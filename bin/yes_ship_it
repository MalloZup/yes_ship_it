#!/usr/bin/ruby

require_relative("../lib/yes_ship_it.rb")

config_file = "yes_ship_it.conf"

if !File.exist?(config_file)
  STDERR.puts("Unable to find file `yes_ship_it.conf`. I need it.")
  exit 1
end

if ARGV[0] == "changelog"
  engine = YSI::Engine.new
  engine.check_assertion(YSI::Version)
  system("git log #{engine.tag}..HEAD")
  exit 0
else
  puts "Shipping..."
  puts

  engine = YSI::Engine.new
  engine.dry_run = ARGV == ["--dry-run"]

  begin
    engine.read(config_file)

    exit engine.run
  rescue YSI::Error => e
    STDERR.puts e
    exit 1
  end
end
